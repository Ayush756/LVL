import pandas as pd
from sqlalchemy import create_engine

# === Configuration ===
user = 'kishor'
password = 'kishor'  # Replace with your actual password
host = 'localhost'
port = '5432'
database = 'LVL'
table_name = 'competitors'
csv_file_path = r'E:\project\LVL\math\data\data.csv'  # Use raw string for Windows path

# === 1. Read the CSV file ===
df = pd.read_csv(csv_file_path)
print("Loaded CSV data:")
print(df.head())

# === 2. Create the PostgreSQL engine ===
connection_string = f'postgresql+psycopg2://{user}:{password}@{host}:{port}/{database}'
engine = create_engine(connection_string)

# === 3. Write to PostgreSQL ===
df.to_sql(table_name, engine, if_exists='replace', index=False)
print(f"\nData successfully inserted into '{table_name}' table in '{database}' database.")

# === 4. Optional: Fetch data to verify ===
verify_df = pd.read_sql(f"SELECT * FROM {table_name}", engine)
print("\nSample data from DB:")
print(verify_df.head())
print(df)
print(verify_df)